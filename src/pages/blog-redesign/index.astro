---
/**
 * Blog Redesign - Liste Articles
 * 
 * Page d'index du blog avec :
 * - Grid articles responsive
 * - Filtres par tag
 * - Articles featured en avant
 * - 100% Astro pur (0 KB JS)
 */

import { getCollection } from 'astro:content';
import LayoutRedesign from '../../layouts/LayoutRedesign.astro';
import { GridBackground } from '../../components/redesign/layout/GridBackground';
import Header from '../../components/redesign/layout/Header';
import Footer from '../../components/redesign/layout/Footer.astro';
import { Calendar, Clock, Tag, ArrowRight } from 'lucide-react';

const title = "Blog Rétro Gaming - PIXEL CLASH";
const description = "Actualités, guides et histoire du rétro gaming. Découvrez nos articles sur les classiques de l'arcade et les consoles vintage.";

// Récupérer tous les articles (non-draft)
const allPosts = await getCollection('blog-redesign', ({ data }) => {
  return data.draft !== true;
});

// Trier par date (plus récent en premier)
const sortedPosts = allPosts.sort((a, b) => 
  b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Séparer featured et regular
const featuredPosts = sortedPosts.filter(post => post.data.featured);
const regularPosts = sortedPosts.filter(post => !post.data.featured);

// Extraire tous les tags uniques
const allTags = [...new Set(allPosts.flatMap(post => post.data.tags))].sort();

// Formater date
const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('fr-FR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
};
---

<LayoutRedesign title={title} description={description}>
  <div class="min-h-screen bg-bg-dark text-text-light">
    
    <Header client:load currentPath={Astro.url.pathname} />
    <GridBackground client:only="react" />
    
    <div class="pt-20">
      
      <!-- Hero Section -->
      <section class="relative py-20">
        <div class="container mx-auto px-4 relative z-10">
          <div class="max-w-4xl mx-auto text-center">
            <div class="inline-block mb-4">
              <span class="text-neon-cyan tracking-widest text-sm uppercase font-bold">
                BLOG RÉTRO GAMING
              </span>
            </div>
            <h1 class="text-5xl md:text-6xl lg:text-7xl mb-6 font-bold">
              <span class="bg-gradient-to-r from-neon-cyan via-neon-magenta to-neon-cyan bg-clip-text text-transparent">
                Actualités & Guides
              </span>
            </h1>
            <p class="text-xl text-text-muted mb-8">
              Plongez dans l'univers du rétro gaming avec nos articles, guides et analyses
            </p>
            <div class="flex flex-wrap gap-2 justify-center">
              {allTags.map((tag) => (
                <a
                  href={`/blog-redesign/tags/${tag}`}
                  class="px-4 py-2 rounded-full bg-neon-cyan/10 border border-neon-cyan/30 text-neon-cyan hover:bg-neon-cyan/20 transition-all text-sm"
                >
                  #{tag}
                </a>
              ))}
            </div>
          </div>
        </div>
      </section>

      <!-- Featured Articles -->
      {featuredPosts.length > 0 && (
        <section class="relative py-12">
          <div class="container mx-auto px-4 relative z-10">
            <h2 class="text-3xl font-bold mb-8">
              <span class="text-neon-magenta">⭐</span> Articles à la Une
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              {featuredPosts.map((post) => (
                <article class="group relative">
                  <!-- Glow effect -->
                  <div class="absolute inset-0 bg-gradient-to-r from-neon-cyan to-neon-magenta rounded-2xl opacity-0 group-hover:opacity-20 transition-opacity duration-300 blur-2xl" />
                  
                  <!-- Card -->
                  <a href={`/blog-redesign/${post.id}`} class="block relative h-full p-6 rounded-2xl bg-bg-dark/60 backdrop-blur-xl border border-neon-cyan/20 group-hover:border-neon-cyan/50 transition-all duration-300">
                    
                    {post.data.image && (
                      <div class="mb-4 rounded-xl overflow-hidden">
                        <img
                          src={post.data.image.url}
                          alt={post.data.image.alt}
                          class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
                          loading="lazy"
                        />
                      </div>
                    )}

                    <div class="flex flex-wrap gap-2 mb-3">
                      {post.data.tags.slice(0, 3).map((tag) => (
                        <span class="px-3 py-1 text-xs rounded-full bg-neon-magenta/10 border border-neon-magenta/30 text-neon-magenta">
                          {tag}
                        </span>
                      ))}
                    </div>

                    <h3 class="text-2xl font-bold text-text-light mb-3 group-hover:text-neon-cyan transition-colors">
                      {post.data.title}
                    </h3>

                    <p class="text-text-muted mb-4 line-clamp-2">
                      {post.data.description}
                    </p>

                    <div class="flex items-center gap-4 text-sm text-text-muted">
                      <div class="flex items-center gap-1">
                        <Calendar className="w-4 h-4" />
                        <span>{formatDate(post.data.pubDate)}</span>
                      </div>
                      {post.data.readingTime && (
                        <div class="flex items-center gap-1">
                          <Clock className="w-4 h-4" />
                          <span>{post.data.readingTime} min</span>
                        </div>
                      )}
                    </div>

                    <div class="mt-4 flex items-center gap-2 text-neon-cyan font-medium">
                      Lire l'article
                      <ArrowRight className="w-4 h-4 group-hover:translate-x-1 transition-transform" />
                    </div>
                  </a>
                </article>
              ))}
            </div>
          </div>
        </section>
      )}

      <!-- Regular Articles -->
      {regularPosts.length > 0 && (
        <section class="relative py-12">
          <div class="container mx-auto px-4 relative z-10">
            <h2 class="text-3xl font-bold mb-8 text-text-light">
              Tous les Articles
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              {regularPosts.map((post) => (
                <article class="group relative">
                  <div class="absolute inset-0 bg-gradient-to-r from-neon-magenta to-neon-cyan rounded-xl opacity-0 group-hover:opacity-10 transition-opacity duration-300 blur-xl" />
                  
                  <a href={`/blog-redesign/${post.slug}`} class="block relative h-full p-5 rounded-xl bg-bg-dark/40 backdrop-blur-md border border-neon-cyan/20 group-hover:border-neon-cyan/40 transition-all">
                    
                    {post.data.image && (
                      <div class="mb-3 rounded-lg overflow-hidden">
                        <img
                          src={post.data.image.url}
                          alt={post.data.image.alt}
                          class="w-full h-40 object-cover group-hover:scale-105 transition-transform duration-300"
                          loading="lazy"
                        />
                      </div>
                    )}

                    <div class="flex flex-wrap gap-2 mb-2">
                      {post.data.tags.slice(0, 2).map((tag) => (
                        <span class="px-2 py-1 text-xs rounded-full bg-neon-cyan/10 border border-neon-cyan/20 text-neon-cyan">
                          {tag}
                        </span>
                      ))}
                    </div>

                    <h3 class="text-xl font-bold text-text-light mb-2 group-hover:text-neon-magenta transition-colors line-clamp-2">
                      {post.data.title}
                    </h3>

                    <p class="text-text-muted text-sm mb-3 line-clamp-2">
                      {post.data.description}
                    </p>

                    <div class="flex items-center gap-3 text-xs text-text-muted">
                      <div class="flex items-center gap-1">
                        <Calendar className="w-3 h-3" />
                        <span>{formatDate(post.data.pubDate)}</span>
                      </div>
                      {post.data.readingTime && (
                        <div class="flex items-center gap-1">
                          <Clock className="w-3 h-3" />
                          <span>{post.data.readingTime} min</span>
                        </div>
                      )}
                    </div>
                  </a>
                </article>
              ))}
            </div>
          </div>
        </section>
      )}

      <!-- Empty State -->
      {allPosts.length === 0 && (
        <section class="relative py-20">
          <div class="container mx-auto px-4 relative z-10 text-center">
            <p class="text-text-muted text-xl">
              Aucun article disponible pour le moment.
            </p>
          </div>
        </section>
      )}

    </div>

    <Footer />

  </div>
</LayoutRedesign>
