---
/**
 * Blog Article Page - Conforme Figma Make
 */

import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import LayoutRedesign from '../../layouts/LayoutRedesign.astro';
import Header from '../../components/redesign/layout/Header';
import Footer from '../../components/redesign/layout/Footer.astro';
import BlogProgressBar from '../../components/redesign/blog/BlogProgressBar';
import BlogTOC from '../../components/redesign/blog/BlogTOC';

export async function getStaticPaths() {
  const posts = await getCollection('blog-redesign', ({ data }) => {
    return data.draft !== true;
  });
  
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<'blog-redesign'>;
}

const { post } = Astro.props;
const { Content } = await post.render();

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('fr-FR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
};

const title = post.data.title;
const description = post.data.description;
const category = post.data.tags[0] || "Retro-Guide";
const date = formatDate(post.data.pubDate);
const readTime = `${post.data.readingTime || 8} min`;
const image = post.data.image?.url || "https://images.unsplash.com/photo-1583634852966-130c15654305";
---

<LayoutRedesign title={title} description={description}>
  <div class="min-h-screen bg-[#0a0a1f] text-white">
    
    <Header client:load currentPath={Astro.url.pathname} />
    
    {/* Progress Bar */}
    <BlogProgressBar client:load />

    {/* Grid Pattern Background */}
    <div class="fixed inset-0 opacity-20 pointer-events-none">
      <div 
        class="w-full h-full" 
        style={{
          backgroundImage: 'linear-gradient(#00f3ff 1px, transparent 1px), linear-gradient(90deg, #00f3ff 1px, transparent 1px)',
          backgroundSize: '50px 50px',
          opacity: 0.1
        }}
      />
    </div>

    {/* Hero Section */}
    <section class="relative min-h-[70vh] flex items-end overflow-hidden pt-20">
      {/* Background Image with Overlay */}
      <div class="absolute inset-0">
        <img 
          src={image}
          alt={title}
          class="w-full h-full object-cover"
        />
        <div class="absolute inset-0 bg-gradient-to-b from-[#0a0a1f]/70 via-[#0a0a1f]/80 to-[#0a0a1f]" />
      </div>

      {/* Content */}
      <div class="container mx-auto px-4 relative z-10 pb-12">
        <div class="max-w-4xl">
          {/* Back Button */}
          <a 
            href="/blog-redesign"
            class="inline-flex items-center gap-2 mb-6 px-6 py-3 text-cyan-400 hover:text-white border border-cyan-500/30 hover:border-cyan-500 hover:bg-cyan-500/10 transition-all rounded-lg font-bold"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Retour au Blog
          </a>

          {/* Meta */}
          <div class="flex flex-wrap items-center gap-3 mb-6">
            <span class="px-4 py-2 rounded-full bg-cyan-500/10 border border-cyan-500/30 backdrop-blur-md text-cyan-400 text-sm uppercase tracking-wider">
              {category}
            </span>
            <span class="text-gray-400 text-sm flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              {readTime} de lecture
            </span>
            <span class="text-gray-400 text-sm">{date}</span>
          </div>

          {/* Title */}
          <h1 class="text-4xl md:text-6xl lg:text-7xl mb-6 leading-tight font-bold">
            <span class="bg-gradient-to-r from-[#00f3ff] via-[#ff00ff] to-[#00f3ff] bg-clip-text text-transparent">
              {title}
            </span>
          </h1>

          {/* Excerpt */}
          <p class="text-xl text-gray-300 leading-relaxed">
            {description}
          </p>
        </div>
      </div>
    </section>

    {/* Main Content Area with TOC */}
    <section class="relative py-12">
      <div class="container mx-auto px-4 relative z-10">
        <div class="grid lg:grid-cols-12 gap-8">
          {/* Sticky Table of Contents - HUD Style */}
          <aside class="lg:col-span-3 hidden lg:block">
            <BlogTOC client:load />
          </aside>

          {/* Article Content */}
          <article class="lg:col-span-9">
            <div class="max-w-3xl mx-auto">
              <div 
                id="content"
                class="prose prose-invert prose-cyan max-w-none
                  prose-headings:text-text-light
                  prose-h2:text-3xl prose-h2:font-normal prose-h2:mb-4 prose-h2:mt-12
                  prose-h3:text-xl prose-h3:font-normal prose-h3:mb-2 prose-h3:mt-6
                  prose-p:text-gray-300 prose-p:leading-relaxed prose-p:mb-4
                  prose-a:text-cyan-400 prose-a:no-underline hover:prose-a:text-cyan-300
                  prose-strong:text-white prose-strong:font-bold
                  prose-em:text-cyan-400 prose-em:not-italic
                  prose-ul:list-none prose-ul:space-y-3 prose-ul:mb-4 prose-ul:pl-0
                  prose-li:flex prose-li:items-start prose-li:gap-3 prose-li:text-gray-300
                  prose-li:before:content-[''] prose-li:before:w-2 prose-li:before:h-2 prose-li:before:bg-cyan-400 prose-li:before:rounded-full prose-li:before:mt-2 prose-li:before:flex-shrink-0
                  prose-blockquote:p-6 prose-blockquote:rounded-xl prose-blockquote:bg-cyan-500/5 prose-blockquote:border prose-blockquote:border-cyan-500/20 prose-blockquote:my-6 prose-blockquote:not-italic prose-blockquote:text-cyan-400
                  prose-code:text-cyan-400 prose-code:bg-[#0a0a1f] prose-code:px-2 prose-code:py-1 prose-code:rounded
                "
              >
                <Content />
              </div>

              {/* CTA Box */}
              <div class="mt-12 p-8 rounded-2xl bg-gradient-to-r from-[#ff00ff]/10 to-[#00f3ff]/10 border border-cyan-500/30 backdrop-blur-xl">
                <h3 class="text-2xl mb-4 font-bold">
                  <span class="bg-gradient-to-r from-[#00f3ff] to-[#ff00ff] bg-clip-text text-transparent">
                    Rejoignez PIXEL CLASH Championship 2026
                  </span>
                </h3>
                <p class="text-gray-300 mb-6">
                  Vivez l'expérience arcade ultime et écrivez votre propre légende gaming.
                </p>
                <a 
                  href="/tournament-redesign"
                  class="inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-[#ff00ff] to-[#00f3ff] hover:from-[#ff00ff]/90 hover:to-[#00f3ff]/90 text-white border-0 shadow-lg shadow-purple-500/50 rounded-lg font-bold transition-all"
                >
                  S'inscrire au Tournoi
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="rotate-180">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                  </svg>
                </a>
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>

      {/* Author Card - Player Profile Style */}
      <section class="relative py-12 border-t border-cyan-500/20 bg-[#0a0a1f]">
        <div class="container mx-auto px-4 relative z-10">
          <div class="max-w-3xl mx-auto">
            <div class="p-8 rounded-2xl bg-[#0a0a1f]/60 backdrop-blur-xl border border-cyan-500/30 shadow-lg shadow-cyan-500/10">
              <div class="flex items-start gap-6">
                {/* Avatar */}
                <div class="relative">
                  <div class="w-24 h-24 rounded-2xl bg-gradient-to-br from-[#00f3ff] to-[#ff00ff] p-1">
                    <div class="w-full h-full rounded-xl bg-[#0a0a1f] flex items-center justify-center">
                      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-cyan-400">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                      </svg>
                    </div>
                  </div>
                  <div class="absolute -bottom-2 -right-2 w-8 h-8 rounded-lg bg-yellow-400 flex items-center justify-center shadow-lg shadow-yellow-400/50">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-[#0a0a1f]">
                      <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                      <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                      <path d="M4 22h16"></path>
                      <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                      <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                      <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
                    </svg>
                  </div>
                </div>

                {/* Info */}
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-2">
                    <h3 class="text-2xl text-white font-bold">Thomas "RetroKing" Dubois</h3>
                    <span class="px-3 py-1 rounded-full bg-cyan-500/10 border border-cyan-500/30 text-cyan-400 text-xs uppercase tracking-wider">
                      Rédacteur En Chef
                    </span>
                  </div>
                  <p class="text-gray-400 leading-relaxed mb-4">
                    Passionné de retro gaming depuis 1987. Collectionneur de bornes d'arcade et expert en histoire du jeu vidéo. Champion PIXEL CLASH 2023.
                  </p>

                  {/* Stats */}
                  <div class="flex gap-6">
                    <div>
                      <div class="text-2xl font-mono text-cyan-400 font-bold">42</div>
                      <div class="text-xs text-gray-500 uppercase">Articles</div>
                    </div>
                    <div>
                      <div class="text-2xl font-mono text-[#ff00ff] font-bold">15K</div>
                      <div class="text-xs text-gray-500 uppercase">Lecteurs</div>
                    </div>
                    <div>
                      <div class="text-2xl font-mono text-yellow-400 font-bold">Level 8</div>
                      <div class="text-xs text-gray-500 uppercase">Expert</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <Footer />

  </div>
</LayoutRedesign>

<style is:global>
  /* Gradient sur H2 mais pas sur les emojis */
  #content h2 {
    background: linear-gradient(to right, #00f3ff, #ff00ff);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  /* Les emojis dans les H2 gardent leur couleur native */
  #content h2 .emoji {
    background: none;
    -webkit-text-fill-color: initial;
    color: inherit;
  }
</style>
