---
/**
 * Blog Listing Page - Conforme Figma Make
 */

import { getCollection } from 'astro:content';
import LayoutRedesign from '../../layouts/LayoutRedesign.astro';
import Header from '../../components/redesign/layout/Header';
import Footer from '../../components/redesign/layout/Footer.astro';
import BlogListingPage from '../../components/redesign/blog/BlogListingPage';

const title = "Blog Retrogaming | Actualités Jeux Arcade & Guides Tournoi - PIXEL CLASH";
const description = "Découvrez l'histoire du retrogaming, guides jeux arcade, stratégies tournoi et actualités gaming. Articles experts pour passionnés de jeux vidéo classiques années 80-90.";

// Récupérer tous les articles
const allPosts = await getCollection('blog-redesign', ({ data }) => {
  return data.draft !== true;
});

// Mapper vers le format attendu par BlogListingPage
const articles = allPosts.map((post) => ({
  id: post.id,
  title: post.data.title,
  excerpt: post.data.description,
  category: post.data.tags[0] || "Retro-Guide", // Première tag comme catégorie
  date: new Intl.DateTimeFormat('fr-FR', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  }).format(post.data.pubDate),
  readTime: `${post.data.readingTime || 8} min`,
  image: post.data.image?.url || "https://images.unsplash.com/photo-1583634852966-130c15654305",
  featured: post.data.featured || false
}));
---

<LayoutRedesign title={title} description={description}>
  <div class="min-h-screen bg-bg-dark text-text-light">
    
    <Header client:load currentPath={Astro.url.pathname} />
    
    <div class="pt-20">
      <BlogListingPage client:load articles={articles} />
    </div>

    <Footer />

  </div>
</LayoutRedesign>
